<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexa AI - Ultra Realistic Assistant</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        /* Enhanced CSS Variables */
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --primary-light: #818cf8;
            --secondary: #8b5cf6;
            --secondary-dark: #7c3aed;
            --accent: #06b6d4;
            --accent-light: #22d3ee;
            --skin: #ffd7c7;
            --skin-shadow: #e6b8a7;
            --skin-highlight: #ffe8e0;
            --eye-color: #1a365d;
            --hair-color: #2d3748;
            --lip-color: #e53e3e;
            --lip-inner: #fc8181;
            --dark: #0f172a;
            --darker: #020617;
            --dark-light: #1e293b;
            --light: #f8fafc;
            --light-gray: #e2e8f0;
            --gray: #64748b;
            --gray-light: #94a3b8;
            --success: #10b981;
            --success-light: #34d399;
            --warning: #f59e0b;
            --warning-light: #fbbf24;
            --error: #ef4444;
            --error-light: #f87171;
            --glass: rgba(255, 255, 255, 0.07);
            --glass-dark: rgba(15, 23, 42, 0.7);
            --glass-border: rgba(255, 255, 255, 0.12);
            --shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.35);
            --shadow-light: 0 10px 25px rgba(0, 0, 0, 0.2);
            --shadow-hover: 0 35px 60px -15px rgba(0, 0, 0, 0.4);
            --gradient-primary: linear-gradient(135deg, var(--primary), var(--secondary));
            --gradient-accent: linear-gradient(135deg, var(--accent), var(--accent-light));
            --gradient-dark: linear-gradient(135deg, var(--darker), var(--dark));
            --gradient-skin: linear-gradient(135deg, var(--skin-highlight), var(--skin), var(--skin-shadow));
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', 'Poppins', sans-serif;
        }

        body {
            background: var(--gradient-dark);
            color: var(--light);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* Animated Background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 30%, rgba(99, 102, 241, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(139, 92, 246, 0.12) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(6, 182, 212, 0.1) 0%, transparent 50%);
            z-index: -2;
            animation: backgroundPulse 20s ease-in-out infinite alternate;
        }

        @keyframes backgroundPulse {
            0% { opacity: 0.8; }
            100% { opacity: 1; }
        }

        /* Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 30px 0;
            margin-bottom: 30px;
            position: relative;
        }

        .header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 95%;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--glass-border), transparent);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 18px;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .logo:hover {
            transform: translateX(5px);
        }

        .logo-icon {
            width: 56px;
            height: 56px;
            background: var(--gradient-primary);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 26px;
            color: white;
            box-shadow: 0 15px 35px rgba(99, 102, 241, 0.4);
        }

        .logo-text {
            font-family: 'Poppins', sans-serif;
            font-size: 32px;
            font-weight: 800;
            background: linear-gradient(135deg, var(--light), var(--accent-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -0.5px;
        }

        .logo-subtitle {
            font-size: 12px;
            color: var(--gray-light);
            font-weight: 500;
            letter-spacing: 1px;
            margin-top: -5px;
        }

        /* Quick Questions Panel */
        .quick-questions {
            position: absolute;
            top: 130px;
            right: 0;
            width: 300px;
            background: var(--glass-dark);
            backdrop-filter: blur(25px);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow);
            z-index: 1000;
            display: none;
            animation: slideInRight 0.3s ease-out;
        }

        .quick-questions.show {
            display: block;
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .questions-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            color: white;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .question-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .question-btn {
            padding: 14px 20px;
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 14px;
            color: var(--light-gray);
            text-align: left;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .question-btn:hover {
            background: rgba(99, 102, 241, 0.2);
            transform: translateX(5px);
            border-color: var(--primary);
        }

        /* Navigation */
        .nav-links {
            display: flex;
            gap: 35px;
            list-style: none;
        }

        .nav-link {
            color: var(--light-gray);
            text-decoration: none;
            font-weight: 500;
            font-size: 16px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            padding: 8px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-link::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 2px;
            background: var(--gradient-primary);
            transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 2px;
        }

        .nav-link:hover {
            color: white;
        }

        .nav-link:hover::before {
            width: 100%;
        }

        .nav-link.active {
            color: white;
        }

        .nav-link.active::before {
            width: 100%;
        }

        /* Main Content */
        .main-content {
            display: grid;
            grid-template-columns: 1.1fr 1.9fr;
            gap: 35px;
            margin-top: 40px;
        }

        /* REALISTIC HUMAN AVATAR SECTION */
        .avatar-section {
            background: var(--glass-dark);
            backdrop-filter: blur(25px);
            border-radius: 28px;
            padding: 35px;
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .avatar-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: var(--gradient-primary);
        }

        .section-title {
            font-family: 'Poppins', sans-serif;
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 30px;
            color: white;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .section-title i {
            color: var(--accent-light);
            background: rgba(6, 182, 212, 0.1);
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        /* ULTRA REALISTIC HUMAN AVATAR */
        .human-avatar-container {
            position: relative;
            width: 100%;
            height: 380px;
            background: rgba(30, 41, 59, 0.3);
            border-radius: 24px;
            overflow: hidden;
            margin-bottom: 35px;
            border: 1px solid var(--glass-border);
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .human-avatar {
            position: relative;
            width: 280px;
            height: 280px;
            transform-style: preserve-3d;
            perspective: 1000px;
        }

        /* Face Structure */
        .face-base {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--gradient-skin);
            border-radius: 50%;
            box-shadow: 
                inset 0 -20px 30px rgba(0, 0, 0, 0.2),
                inset 20px 0 30px rgba(255, 255, 255, 0.1),
                inset -20px 0 30px rgba(0, 0, 0, 0.1),
                0 15px 40px rgba(0, 0, 0, 0.3);
            animation: subtleBreathing 4s ease-in-out infinite;
        }

        /* Cheeks */
        .cheek {
            position: absolute;
            width: 60px;
            height: 40px;
            background: radial-gradient(circle at 30% 30%, #ffb8a8, transparent 70%);
            border-radius: 50%;
            top: 150px;
            opacity: 0.3;
            animation: blushPulse 8s infinite;
        }

        .cheek-left {
            left: 50px;
        }

        .cheek-right {
            right: 50px;
        }

        /* Forehead */
        .forehead {
            position: absolute;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            width: 120px;
            height: 50px;
            background: linear-gradient(to bottom, var(--skin-highlight), var(--skin));
            border-radius: 50% 50% 0 0;
            box-shadow: inset 0 10px 20px rgba(255, 255, 255, 0.2);
        }

        /* Ultra Realistic Eyes */
        .eyes-container {
            position: absolute;
            top: 100px;
            left: 50%;
            transform: translateX(-50%);
            width: 160px;
            height: 80px;
            display: flex;
            justify-content: space-between;
            z-index: 2;
        }

        .eye-wrapper {
            position: relative;
            width: 70px;
            height: 70px;
        }

        .eye {
            position: absolute;
            width: 100%;
            height: 100%;
            background: white;
            border-radius: 50%;
            overflow: hidden;
            box-shadow: 
                0 5px 15px rgba(0, 0, 0, 0.3),
                inset 0 -2px 10px rgba(0, 0, 0, 0.1),
                inset 0 2px 10px rgba(255, 255, 255, 0.8);
        }

        .eyelid {
            position: absolute;
            width: 100%;
            height: 40px;
            background: var(--skin);
            border-radius: 50% 50% 0 0;
            top: -10px;
            z-index: 3;
            transform-origin: bottom;
            transition: transform 0.3s ease;
        }

        .eye-inner {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 50px;
            height: 50px;
            background: radial-gradient(circle at 30% 30%, var(--eye-color), #0f172a);
            border-radius: 50%;
            box-shadow: 
                inset 0 0 20px rgba(0, 0, 0, 0.5),
                0 0 10px rgba(255, 255, 255, 0.2);
        }

        .pupil {
            position: absolute;
            top: 15px;
            left: 15px;
            width: 20px;
            height: 20px;
            background: black;
            border-radius: 50%;
            box-shadow: 
                inset 0 0 10px rgba(0, 0, 0, 0.8),
                0 0 5px rgba(255, 255, 255, 0.3);
        }

        .eye-sparkle {
            position: absolute;
            top: 10px;
            left: 10px;
            width: 8px;
            height: 8px;
            background: white;
            border-radius: 50%;
            filter: blur(1px);
            animation: sparkleTwinkle 3s infinite alternate;
        }

        /* Eyebrows */
        .eyebrow {
            position: absolute;
            width: 75px;
            height: 12px;
            background: var(--hair-color);
            border-radius: 6px;
            top: -25px;
            z-index: 1;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }

        .eyebrow-left {
            left: -5px;
            transform: rotate(5deg);
        }

        .eyebrow-right {
            right: -5px;
            transform: rotate(-5deg);
        }

        /* Nose - More Realistic */
        .nose {
            position: absolute;
            top: 160px;
            left: 50%;
            transform: translateX(-50%);
            width: 25px;
            height: 40px;
            background: linear-gradient(to right, var(--skin-shadow), var(--skin));
            border-radius: 12px;
            box-shadow: 
                0 5px 15px rgba(0, 0, 0, 0.2),
                inset 0 -2px 5px rgba(0, 0, 0, 0.1);
            z-index: 1;
        }

        .nose-bridge {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            width: 15px;
            height: 30px;
            background: linear-gradient(to bottom, var(--skin), var(--skin-shadow));
            border-radius: 7px;
        }

        /* Ultra Realistic Mouth */
        .mouth-container {
            position: absolute;
            top: 220px;
            left: 50%;
            transform: translateX(-50%);
            width: 120px;
            height: 60px;
            z-index: 2;
        }

        .mouth {
            position: absolute;
            width: 100%;
            height: 40px;
            background: linear-gradient(to bottom, var(--lip-color), #c53030);
            border-radius: 0 0 60px 60px;
            box-shadow: 
                0 5px 20px rgba(229, 62, 62, 0.3),
                inset 0 -5px 10px rgba(0, 0, 0, 0.2),
                inset 0 5px 10px rgba(255, 255, 255, 0.1);
            overflow: hidden;
            transition: all 0.2s ease;
        }

        .mouth-inner {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 90px;
            height: 20px;
            background: linear-gradient(to top, var(--lip-inner), #fed7d7);
            border-radius: 40px 40px 0 0;
        }

        .tongue {
            position: absolute;
            bottom: 5px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 15px;
            background: linear-gradient(to bottom, #fc8181, #feb2b2);
            border-radius: 20px 20px 0 0;
            display: none;
            box-shadow: inset 0 -3px 5px rgba(0, 0, 0, 0.1);
        }

        .mouth.talking .tongue {
            display: block;
            animation: tongueTalk 0.5s infinite alternate;
        }

        /* Lips Outline */
        .lips-outline {
            position: absolute;
            width: 100%;
            height: 100%;
            border: 2px solid rgba(229, 62, 62, 0.3);
            border-radius: 0 0 60px 60px;
            box-sizing: border-box;
        }

        /* Hair - More Realistic */
        .hair {
            position: absolute;
            top: -40px;
            left: 50%;
            transform: translateX(-50%);
            width: 300px;
            height: 100px;
            background: linear-gradient(to bottom, var(--hair-color), #1a202c);
            border-radius: 50% 50% 0 0;
            box-shadow: 
                0 10px 30px rgba(0, 0, 0, 0.4),
                inset 0 -10px 20px rgba(0, 0, 0, 0.3);
            z-index: 0;
        }

        .hair-strands {
            position: absolute;
            top: 60px;
            left: 50%;
            transform: translateX(-50%);
            width: 250px;
            height: 40px;
            background: linear-gradient(to bottom, #4a5568, var(--hair-color));
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        /* Ears */
        .ear {
            position: absolute;
            width: 30px;
            height: 40px;
            background: var(--skin);
            border-radius: 15px;
            top: 140px;
            z-index: -1;
        }

        .ear-left {
            left: 10px;
            transform: rotate(-10deg);
        }

        .ear-right {
            right: 10px;
            transform: rotate(10deg);
        }

        /* Neck */
        .neck {
            position: absolute;
            top: 260px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 40px;
            background: linear-gradient(to bottom, var(--skin), var(--skin-shadow));
            border-radius: 0 0 30px 30px;
            z-index: -2;
        }

        /* Avatar Status */
        .avatar-status {
            position: absolute;
            bottom: 25px;
            left: 25px;
            right: 25px;
            display: flex;
            align-items: center;
            gap: 12px;
            background: rgba(0, 0, 0, 0.4);
            padding: 16px 24px;
            border-radius: 16px;
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
        }

        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--gradient-primary);
            animation: statusPulse 2s infinite;
        }

        .status-text {
            font-size: 15px;
            color: var(--light-gray);
            font-weight: 500;
            flex: 1;
        }

        .status-action {
            background: var(--gradient-primary);
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .status-action:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.4);
        }

        /* Mood Indicators */
        .mood-indicator {
            position: absolute;
            top: 25px;
            right: 25px;
            display: flex;
            gap: 10px;
        }

        .mood-btn {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid var(--glass-border);
            color: var(--light-gray);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .mood-btn:hover {
            background: var(--primary);
            color: white;
            transform: scale(1.1);
        }

        .mood-btn.active {
            background: var(--primary);
            color: white;
        }

        /* API Configuration Section */
        .api-section {
            margin-top: 30px;
            padding: 25px;
            background: rgba(30, 41, 59, 0.4);
            border-radius: 20px;
            border: 1px solid var(--glass-border);
        }

        .api-input-group {
            position: relative;
            margin-bottom: 20px;
        }

        .api-label {
            font-size: 14px;
            font-weight: 600;
            color: var(--light-gray);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .api-input-wrapper {
            position: relative;
        }

        .api-input {
            width: 100%;
            padding: 16px 52px 16px 24px;
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid var(--glass-border);
            border-radius: 14px;
            color: white;
            font-size: 15px;
            font-family: 'Monaco', 'Consolas', 'Courier New', monospace;
            transition: all 0.3s ease;
            outline: none;
        }

        .api-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.15);
            background: rgba(15, 23, 42, 0.8);
        }

        .api-input::placeholder {
            color: var(--gray-light);
        }

        .api-action {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: transparent;
            border: none;
            color: var(--gray-light);
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s ease;
            padding: 8px;
            border-radius: 8px;
        }

        .api-action:hover {
            color: var(--accent-light);
            background: rgba(6, 182, 212, 0.1);
        }

        /* Test Connection Button */
        .test-connection {
            width: 100%;
            padding: 16px;
            background: var(--gradient-primary);
            color: white;
            border: none;
            border-radius: 14px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .test-connection:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.4);
        }

        .test-connection:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .test-connection.testing {
            background: linear-gradient(135deg, var(--warning), var(--warning-light));
        }

        .test-connection.connected {
            background: linear-gradient(135deg, var(--success), var(--success-light));
        }

        /* Chat Section */
        .chat-section {
            background: var(--glass-dark);
            backdrop-filter: blur(25px);
            border-radius: 28px;
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 720px;
        }

        .chat-header {
            padding: 30px 35px;
            background: rgba(30, 41, 59, 0.7);
            border-bottom: 1px solid var(--glass-border);
            position: relative;
        }

        .chat-header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: var(--gradient-primary);
            opacity: 0.5;
        }

        .chat-title {
            font-family: 'Poppins', sans-serif;
            font-size: 26px;
            font-weight: 700;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 8px;
            letter-spacing: -0.5px;
        }

        .chat-subtitle {
            color: var(--gray-light);
            font-size: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 30px;
            display: flex;
            flex-direction: column;
            gap: 22px;
            scroll-behavior: smooth;
        }

        .message {
            display: flex;
            max-width: 82%;
            animation: messageSlide 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes messageSlide {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            align-self: flex-end;
            flex-direction: row-reverse;
        }

        .message-bubble {
            padding: 18px 22px;
            border-radius: 20px;
            line-height: 1.6;
            font-size: 15px;
            backdrop-filter: blur(10px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        .message.ai .message-bubble {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.18), rgba(139, 92, 246, 0.12));
            border: 1px solid rgba(99, 102, 241, 0.25);
            color: var(--light-gray);
            border-bottom-left-radius: 6px;
        }

        .message.user .message-bubble {
            background: linear-gradient(135deg, rgba(6, 182, 212, 0.18), rgba(14, 165, 233, 0.12));
            border: 1px solid rgba(6, 182, 212, 0.25);
            color: var(--light-gray);
            border-bottom-right-radius: 6px;
        }

        .message-avatar {
            width: 44px;
            height: 44px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            margin: 0 16px;
            flex-shrink: 0;
            align-self: flex-end;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }

        .message.ai .message-avatar {
            background: var(--gradient-primary);
            color: white;
        }

        .message.user .message-avatar {
            background: var(--gradient-accent);
            color: white;
        }

        /* Enhanced message with emotions */
        .message.ai[data-emotion] .message-bubble::before {
            content: attr(data-emotion);
            font-size: 12px;
            background: rgba(99, 102, 241, 0.2);
            padding: 4px 12px;
            border-radius: 12px;
            margin-right: 10px;
            display: inline-block;
            margin-bottom: 8px;
        }

        .chat-input-area {
            padding: 30px;
            background: rgba(30, 41, 59, 0.7);
            border-top: 1px solid var(--glass-border);
        }

        .input-container {
            display: flex;
            gap: 18px;
            align-items: center;
        }

        .chat-input {
            flex: 1;
            padding: 18px 28px;
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid var(--glass-border);
            border-radius: 18px;
            color: white;
            font-size: 16px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            outline: none;
        }

        .chat-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.15);
            background: rgba(30, 41, 59, 0.8);
        }

        .send-btn {
            width: 60px;
            height: 60px;
            border-radius: 18px;
            background: var(--gradient-primary);
            border: none;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.4);
        }

        .send-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 20px 40px rgba(99, 102, 241, 0.6);
        }

        .voice-btn {
            width: 60px;
            height: 60px;
            border-radius: 18px;
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid var(--glass-border);
            color: var(--primary-light);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .voice-btn:hover {
            background: rgba(30, 41, 59, 0.8);
            border-color: var(--primary);
        }

        .voice-btn.listening {
            background: var(--gradient-primary);
            color: white;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(99, 102, 241, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(99, 102, 241, 0); }
            100% { box-shadow: 0 0 0 0 rgba(99, 102, 241, 0); }
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 40px;
            right: 40px;
            padding: 22px 28px;
            background: var(--glass-dark);
            backdrop-filter: blur(25px);
            border-radius: 20px;
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow);
            z-index: 10000;
            transform: translateX(150%) translateY(-20px);
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            max-width: 380px;
            border-left: 5px solid var(--primary);
            opacity: 0;
        }

        .notification.show {
            transform: translateX(0) translateY(0);
            opacity: 1;
        }

        .notification.success {
            border-left-color: var(--success);
        }

        .notification.error {
            border-left-color: var(--error);
        }

        .notification.warning {
            border-left-color: var(--warning);
        }

        .notification-content {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .notification-icon {
            width: 44px;
            height: 44px;
            background: rgba(99, 102, 241, 0.1);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: var(--primary);
        }

        .notification.success .notification-icon {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }

        .notification.error .notification-icon {
            background: rgba(239, 68, 68, 0.1);
            color: var(--error);
        }

        .notification.warning .notification-icon {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }

        .notification-text {
            flex: 1;
        }

        .notification-title {
            font-size: 16px;
            font-weight: 700;
            color: white;
            margin-bottom: 5px;
        }

        .notification-message {
            font-size: 14px;
            color: var(--light-gray);
            line-height: 1.5;
        }

        /* Emotion Effects */
        .emotion-happy .cheek {
            opacity: 0.6;
            animation: blushPulse 2s infinite;
        }

        .emotion-thinking .eyebrow {
            transform: translateY(-5px);
        }

        .emotion-sad .mouth {
            transform: translateY(5px);
            height: 35px;
            border-radius: 50%;
        }

        .emotion-excited .eye-sparkle {
            animation: sparkleTwinkle 0.5s infinite alternate;
        }

        /* Animations */
        @keyframes subtleBreathing {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.005);
            }
        }

        @keyframes blushPulse {
            0%, 100% {
                opacity: 0.3;
            }
            50% {
                opacity: 0.7;
            }
        }

        @keyframes eyeBlink {
            0%, 90%, 100% {
                transform: scaleY(1);
            }
            95% {
                transform: scaleY(0.1);
            }
        }

        @keyframes eyeMovement {
            0%, 100% {
                transform: translate(-50%, -50%);
            }
            25% {
                transform: translate(-40%, -40%);
            }
            50% {
                transform: translate(-60%, -50%);
            }
            75% {
                transform: translate(-50%, -60%);
            }
        }

        @keyframes mouthTalk {
            0%, 100% {
                height: 40px;
                border-radius: 0 0 60px 60px;
            }
            50% {
                height: 25px;
                border-radius: 0 0 40px 40px;
            }
        }

        @keyframes tongueTalk {
            0%, 100% {
                height: 15px;
                width: 40px;
            }
            50% {
                height: 10px;
                width: 35px;
            }
        }

        @keyframes statusPulse {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.7;
                transform: scale(1.1);
            }
        }

        @keyframes sparkleTwinkle {
            0%, 100% {
                opacity: 0.8;
                transform: scale(1);
            }
            50% {
                opacity: 1;
                transform: scale(1.3);
            }
        }

        /* Typing Animation */
        @keyframes typingBounce {
            0%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-10px);
            }
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .chat-section {
                height: 650px;
            }
            
            .quick-questions {
                position: relative;
                top: 0;
                right: 0;
                width: 100%;
                margin-bottom: 20px;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .header {
                flex-direction: column;
                gap: 25px;
            }
            
            .nav-links {
                gap: 20px;
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .human-avatar-container {
                height: 320px;
            }
            
            .human-avatar {
                width: 240px;
                height: 240px;
            }
            
            .mood-indicator {
                top: 15px;
                right: 15px;
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(30, 41, 59, 0.4);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--gradient-primary);
            border-radius: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo" id="logo">
                <div class="logo-icon">
                    <i class="fas fa-brain"></i>
                </div>
                <div>
                    <div class="logo-text">Nexa AI</div>
                    <div class="logo-subtitle">ULTRA REALISTIC ASSISTANT</div>
                </div>
            </div>
            <nav>
                <ul class="nav-links">
                    <li><a href="#" class="nav-link active" id="navHome"><i class="fas fa-home"></i> Home</a></li>
                    <li><a href="#" class="nav-link" id="navQuestions"><i class="fas fa-question-circle"></i> Quick Questions</a></li>
                    <li><a href="#" class="nav-link"><i class="fas fa-robot"></i> Assistant</a></li>
                    <li><a href="#" class="nav-link"><i class="fas fa-key"></i> API Setup</a></li>
                    <li><a href="#" class="nav-link"><i class="fas fa-cog"></i> Settings</a></li>
                </ul>
            </nav>
        </header>

        <!-- Quick Questions Panel -->
        <div class="quick-questions" id="quickQuestions">
            <h3 class="questions-title"><i class="fas fa-lightbulb"></i> Quick Questions</h3>
            <div class="question-buttons">
                <button class="question-btn" data-question="life_advice">
                    <i class="fas fa-heart"></i> Life Advice
                </button>
                <button class="question-btn" data-question="creativity">
                    <i class="fas fa-palette"></i> Creativity Tips
                </button>
                <button class="question-btn" data-question="career">
                    <i class="fas fa-briefcase"></i> Career Guidance
                </button>
                <button class="question-btn" data-question="relationships">
                    <i class="fas fa-users"></i> Relationships
                </button>
                <button class="question-btn" data-question="motivation">
                    <i class="fas fa-fire"></i> Daily Motivation
                </button>
                <button class="question-btn" data-question="problem_solving">
                    <i class="fas fa-puzzle-piece"></i> Problem Solving
                </button>
                <button class="question-btn" data-question="mental_health">
                    <i class="fas fa-brain"></i> Mental Wellness
                </button>
                <button class="question-btn" data-question="learning">
                    <i class="fas fa-graduation-cap"></i> Learning Tips
                </button>
            </div>
        </div>

        <div class="main-content">
            <!-- Ultra Realistic Avatar Section -->
            <section class="avatar-section">
                <h2 class="section-title">
                    <i class="fas fa-user-tie"></i> Ultra Realistic AI Assistant
                </h2>
                
                <div class="human-avatar-container">
                    <!-- Mood Controls -->
                    <div class="mood-indicator">
                        <button class="mood-btn" data-mood="default" title="Default">
                            <i class="fas fa-smile"></i>
                        </button>
                        <button class="mood-btn" data-mood="thinking" title="Thinking">
                            <i class="fas fa-lightbulb"></i>
                        </button>
                        <button class="mood-btn" data-mood="happy" title="Happy">
                            <i class="fas fa-laugh"></i>
                        </button>
                        <button class="mood-btn" data-mood="excited" title="Excited">
                            <i class="fas fa-star"></i>
                        </button>
                    </div>
                    
                    <div class="human-avatar">
                        <!-- Hair -->
                        <div class="hair"></div>
                        <div class="hair-strands"></div>
                        
                        <!-- Face Base -->
                        <div class="face-base"></div>
                        
                        <!-- Ears -->
                        <div class="ear ear-left"></div>
                        <div class="ear ear-right"></div>
                        
                        <!-- Forehead -->
                        <div class="forehead"></div>
                        
                        <!-- Cheeks -->
                        <div class="cheek cheek-left"></div>
                        <div class="cheek cheek-right"></div>
                        
                        <!-- Ultra Realistic Eyes -->
                        <div class="eyes-container">
                            <div class="eye-wrapper">
                                <div class="eyebrow eyebrow-left"></div>
                                <div class="eyelid left-eyelid"></div>
                                <div class="eye left-eye">
                                    <div class="eye-inner left-eye-inner">
                                        <div class="pupil left-pupil"></div>
                                        <div class="eye-sparkle left-sparkle"></div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="eye-wrapper">
                                <div class="eyebrow eyebrow-right"></div>
                                <div class="eyelid right-eyelid"></div>
                                <div class="eye right-eye">
                                    <div class="eye-inner right-eye-inner">
                                        <div class="pupil right-pupil"></div>
                                        <div class="eye-sparkle right-sparkle"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Nose -->
                        <div class="nose">
                            <div class="nose-bridge"></div>
                        </div>
                        
                        <!-- Ultra Realistic Mouth -->
                        <div class="mouth-container">
                            <div class="mouth" id="mouth">
                                <div class="mouth-inner"></div>
                                <div class="tongue"></div>
                                <div class="lips-outline"></div>
                            </div>
                        </div>
                        
                        <!-- Neck -->
                        <div class="neck"></div>
                    </div>
                    
                    <div class="avatar-status">
                        <div class="status-indicator"></div>
                        <div class="status-text" id="statusText">Demo Mode Active</div>
                        <button class="status-action" id="connectBtn">Connect API</button>
                    </div>
                </div>
                
                <!-- API Configuration -->
                <div class="api-section">
                    <div class="api-input-group">
                        <label class="api-label">
                            <i class="fas fa-key"></i> Google Gemini API Key
                        </label>
                        <div class="api-input-wrapper">
                            <input type="password" id="apiKey" class="api-input" placeholder="Enter your Gemini API key here...">
                            <button class="api-action" id="toggleApiKey">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        <div class="api-info">
                            <i class="fas fa-info-circle"></i>
                            Get a free API key from <a href="https://makersuite.google.com/app/apikey" target="_blank" style="color: var(--accent-light);">Google AI Studio</a> (60 requests/minute free)
                        </div>
                    </div>
                    
                    <button class="test-connection" id="testConnection">
                        <i class="fas fa-plug"></i> Test Connection
                    </button>
                </div>
            </section>

            <!-- Chat Section -->
            <section class="chat-section">
                <div class="chat-header">
                    <h2 class="chat-title">AI Assistant Chat</h2>
                    <p class="chat-subtitle">
                        <span id="connectionStatus">Demo Mode</span>
                        â€¢ 
                        <span id="modelStatus">Simulated AI</span>
                        â€¢
                        <span id="avatarEmotion">ðŸ˜Š Neutral</span>
                    </p>
                </div>
                
                <div class="chat-messages" id="chatMessages">
                    <!-- Messages will be added here by JavaScript -->
                </div>
                
                <div class="chat-input-area">
                    <div class="input-container">
                        <button class="voice-btn" id="voiceBtn" title="Voice input">
                            <i class="fas fa-microphone"></i>
                        </button>
                        <input type="text" class="chat-input" id="chatInput" placeholder="Ask about life, creativity, relationships, or anything...">
                        <button class="send-btn" id="sendBtn" title="Send message">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification">
        <div class="notification-content">
            <div class="notification-icon">
                <i class="fas fa-info-circle"></i>
            </div>
            <div class="notification-text">
                <div class="notification-title" id="notificationTitle">Welcome</div>
                <div class="notification-message" id="notificationMessage">Loading Ultra Realistic AI Assistant...</div>
            </div>
            <button class="notification-close" id="notificationClose">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </div>

    <!-- Sound Elements (invisible) -->
    <audio id="typingSound" src="https://assets.mixkit.co/sfx/preview/mixkit-fast-keyboard-typing-441.mp3"></audio>
    <audio id="blinkSound" src="https://assets.mixkit.co/sfx/preview/mixkit-quick-soft-blink-2144.mp3"></audio>
    <audio id="smileSound" src="https://assets.mixkit.co/sfx/preview/mixkit-happy-giggle-2214.mp3"></audio>
    <audio id="thinkingSound" src="https://assets.mixkit.co/sfx/preview/mixkit-thinker-667.mp3"></audio>
    <audio id="notificationSound" src="https://assets.mixkit.co/sfx/preview/mixkit-correct-answer-tone-2870.mp3"></audio>

    <!-- JavaScript -->
    <script>
        // ============================================
        // ENHANCED NEXA AI WITH ULTRA REALISTIC FEATURES
        // ============================================

        // DOM Elements
        const leftEyeInner = document.querySelector('.left-eye-inner');
        const rightEyeInner = document.querySelector('.right-eye-inner');
        const leftEyelid = document.querySelector('.left-eyelid');
        const rightEyelid = document.querySelector('.right-eyelid');
        const mouth = document.getElementById('mouth');
        const statusText = document.getElementById('statusText');
        const connectBtn = document.getElementById('connectBtn');
        const apiKeyInput = document.getElementById('apiKey');
        const toggleApiKey = document.getElementById('toggleApiKey');
        const testConnection = document.getElementById('testConnection');
        const chatInput = document.getElementById('chatInput');
        const sendBtn = document.getElementById('sendBtn');
        const voiceBtn = document.getElementById('voiceBtn');
        const chatMessages = document.getElementById('chatMessages');
        const connectionStatus = document.getElementById('connectionStatus');
        const modelStatus = document.getElementById('modelStatus');
        const avatarEmotion = document.getElementById('avatarEmotion');
        const notification = document.getElementById('notification');
        const notificationTitle = document.getElementById('notificationTitle');
        const notificationMessage = document.getElementById('notificationMessage');
        const notificationClose = document.getElementById('notificationClose');
        const quickQuestions = document.getElementById('quickQuestions');
        const navQuestions = document.getElementById('navQuestions');
        const navHome = document.getElementById('navHome');
        const moodButtons = document.querySelectorAll('.mood-btn');
        const questionButtons = document.querySelectorAll('.question-btn');

        // Audio Elements
        const typingSound = document.getElementById('typingSound');
        const blinkSound = document.getElementById('blinkSound');
        const smileSound = document.getElementById('smileSound');
        const thinkingSound = document.getElementById('thinkingSound');
        const notificationSound = document.getElementById('notificationSound');

        // Enhanced State Management
        const state = {
            isConnected: false,
            isDemoMode: true,
            isListening: false,
            isTyping: false,
            isAvatarTalking: false,
            currentMood: 'default',
            currentEmotion: 'neutral',
            apiKey: '',
            conversationHistory: [],
            recognition: null,
            eyeMovementInterval: null,
            blinkInterval: null,
            moodHistory: [],
            soundEnabled: true
        };

        // Comprehensive Knowledge Base with Emotional Responses
        const knowledgeBase = {
            life_advice: [
                {
                    question: "How can I find purpose in life?",
                    answer: "Purpose isn't found, it's built through consistent actions that align with your values. Start small - what makes you lose track of time? What problems do you naturally want to solve? Your purpose emerges from what you do daily, not from a single discovery.",
                    emotion: "thoughtful",
                    mood: "thinking"
                },
                {
                    question: "How to deal with failure?",
                    answer: "Failure is data, not defeat. Every setback teaches what doesn't work. The most successful people have the most failures - they just learn faster. Ask: 'What did this teach me?' rather than 'Why did this happen?'",
                    emotion: "encouraging",
                    mood: "happy"
                },
                {
                    question: "How to be happier?",
                    answer: "Happiness is a practice, not a destination. Three science-backed ways: 1) Gratitude journaling (write 3 things daily), 2) Acts of kindness (small, regular), 3) Mindfulness (5 minutes daily). Happiness compounds through consistent practice.",
                    emotion: "inspiring",
                    mood: "excited"
                },
                {
                    question: "How to overcome anxiety?",
                    answer: "Anxiety is your body's protection system working overtime. Grounding techniques: 5-4-3-2-1 (name 5 things you see, 4 you feel, 3 you hear, 2 you smell, 1 you taste). Remember: anxiety is temporary, and you've survived 100% of your anxious days.",
                    emotion: "calming",
                    mood: "default"
                }
            ],

            creativity: [
                {
                    question: "How to boost creativity?",
                    answer: "Creativity thrives on constraints and novelty. Try: 1) Morning pages (3 pages of stream-of-consciousness writing), 2) Creative cross-training (try a different art form), 3) The 30 Circles Test (fill 30 circles with different things in 3 minutes). Creativity is a muscle that strengthens with use.",
                    emotion: "inspiring",
                    mood: "excited"
                },
                {
                    question: "How to overcome creative block?",
                    answer: "Creative block often means you're trying to be perfect. Lower your standards intentionally - create something 'bad' on purpose. Set a 10-minute timer and create the worst version possible. This bypasses perfectionism and gets the creative juices flowing.",
                    emotion: "encouraging",
                    mood: "thinking"
                },
                {
                    question: "Where do creative ideas come from?",
                    answer: "Ideas are connections between existing concepts. The best way to generate ideas: consume diverse inputs (read outside your field, watch documentaries, talk to people different from you), then let your subconscious connect the dots during walks or showers.",
                    emotion: "thoughtful",
                    mood: "thinking"
                },
                {
                    question: "How to stay creatively motivated?",
                    answer: "Motivation follows action, not the other way around. Create a 'creative ritual' - same time, same place, same starting action (like brewing tea). The consistency creates momentum. Also, track your creative 'streaks' like in a game.",
                    emotion: "inspiring",
                    mood: "happy"
                }
            ],

            career: [
                {
                    question: "How to find the right career?",
                    answer: "Instead of 'What do I want to do?' ask 'What problems do I enjoy solving?' and 'What environments make me feel energized?' Career fit has three components: skills, interests, and values. Map these and look for intersections.",
                    emotion: "thoughtful",
                    mood: "thinking"
                },
                {
                    question: "How to negotiate salary?",
                    answer: "Frame negotiations around value, not need. Research market rates, quantify your contributions, and practice your pitch. Remember: The first number mentioned anchors the negotiation. Be prepared to walk away politely if needed.",
                    emotion: "confident",
                    mood: "default"
                }
            ],

            relationships: [
                {
                    question: "How to improve communication?",
                    answer: "Practice active listening: paraphrase what you heard before responding. Use 'I feel' statements instead of 'You always' accusations. Remember: The goal is understanding, not winning the argument.",
                    emotion: "calming",
                    mood: "default"
                },
                {
                    question: "How to set healthy boundaries?",
                    answer: "Boundaries are about your actions, not others'. Clearly state what you will do if your boundary is crossed. Example: 'I need to end calls by 9 PM to get enough sleep. If we're still talking then, I'll need to say goodbye.'",
                    emotion: "assertive",
                    mood: "thinking"
                }
            ],

            motivation: [
                {
                    question: "How to stay motivated daily?",
                    answer: "Motivation is unreliable - build systems instead. The 2-Minute Rule: If a task takes less than 2 minutes, do it immediately. Habit stacking: Attach new habits to existing ones. Track progress visually - seeing growth is motivating.",
                    emotion: "energetic",
                    mood: "excited"
                }
            ],

            problem_solving: [
                {
                    question: "How to approach complex problems?",
                    answer: "Break problems into smaller parts until they feel manageable. Use the Rubber Duck method: Explain the problem aloud as if to a child. Often, the solution appears during the explanation. Sleep on it - your subconscious works while you rest.",
                    emotion: "analytical",
                    mood: "thinking"
                }
            ],

            mental_health: [
                {
                    question: "How to manage stress?",
                    answer: "Stress needs both physical and mental outlets. Physically: exercise, deep breathing, progressive muscle relaxation. Mentally: cognitive restructuring (challenge negative thoughts), gratitude practice, and scheduled worry time (20 minutes daily to worry intentionally).",
                    emotion: "calming",
                    mood: "default"
                }
            ],

            learning: [
                {
                    question: "How to learn faster?",
                    answer: "Use the Feynman Technique: Learn a concept, then explain it simply as if teaching a child. When you get stuck, you've found a gap in understanding. Also: space out practice sessions and test yourself frequently.",
                    emotion: "enthusiastic",
                    mood: "excited"
                }
            ]
        };

        // Sound Library (fallback to online sounds if needed)
        const soundLibrary = {
            blink: () => {
                if (blinkSound && state.soundEnabled) {
                    blinkSound.currentTime = 0;
                    blinkSound.volume = 0.1;
                    blinkSound.play().catch(e => console.log("Sound play failed:", e));
                }
            },
            smile: () => {
                if (smileSound && state.soundEnabled) {
                    smileSound.currentTime = 0;
                    smileSound.volume = 0.2;
                    smileSound.play().catch(e => console.log("Sound play failed:", e));
                }
            },
            thinking: () => {
                if (thinkingSound && state.soundEnabled) {
                    thinkingSound.currentTime = 0;
                    thinkingSound.volume = 0.15;
                    thinkingSound.play().catch(e => console.log("Sound play failed:", e));
                }
            },
            notification: () => {
                if (notificationSound && state.soundEnabled) {
                    notificationSound.currentTime = 0;
                    notificationSound.volume = 0.3;
                    notificationSound.play().catch(e => console.log("Sound play failed:", e));
                }
            },
            typing: () => {
                if (typingSound && state.soundEnabled) {
                    typingSound.currentTime = 0;
                    typingSound.volume = 0.1;
                    typingSound.play().catch(e => console.log("Sound play failed:", e));
                }
            }
        };

        // Initialize Application
        function init() {
            console.log('ðŸš€ Initializing Enhanced Nexa AI with Emotional Intelligence...');
            
            // Load saved state
            loadSavedState();
            
            // Initialize all systems
            initAvatarAnimations();
            initSpeechRecognition();
            setupEventListeners();
            
            // Add welcome message
            addMessage("Hello! I'm Nexa, your ultra-realistic AI assistant. I can help with life advice, creativity, relationships, career guidance, and more! ðŸ˜Š", 'ai', 'excited');
            addMessage("Try asking about life purpose, creative blocks, or use the Quick Questions menu for instant guidance!", 'ai', 'helpful');
            
            // Show welcome notification with sound
            setTimeout(() => {
                showNotification(
                    'Welcome to Nexa AI',
                    'I\'m here to help with life advice, creativity, relationships, and more!',
                    'info'
                );
                soundLibrary.notification();
            }, 1000);
            
            console.log('âœ… Enhanced Nexa AI initialized successfully');
        }

        // Load Saved State
        function loadSavedState() {
            const savedApiKey = localStorage.getItem('nexa_gemini_api_key');
            const savedConversation = localStorage.getItem('nexa_conversation');
            const savedMood = localStorage.getItem('nexa_current_mood');
            
            if (savedApiKey) {
                state.apiKey = savedApiKey;
                apiKeyInput.value = 'â€¢'.repeat(16);
            }
            
            if (savedConversation) {
                state.conversationHistory = JSON.parse(savedConversation);
                // Display recent conversation
                displayRecentConversation();
            }
            
            if (savedMood) {
                setMood(savedMood);
            }
            
            state.soundEnabled = localStorage.getItem('nexa_sound_enabled') !== 'false';
        }

        // Display Recent Conversation
        function displayRecentConversation() {
            if (state.conversationHistory.length > 0) {
                // Only show last 5 messages
                const recentMessages = state.conversationHistory.slice(-10);
                
                recentMessages.forEach(msg => {
                    if (msg.role === 'assistant') {
                        addMessage(msg.content, 'ai', msg.emotion || 'default');
                    } else {
                        addMessage(msg.content, 'user');
                    }
                });
            }
        }

        // Initialize Ultra Realistic Avatar Animations with Sounds
        function initAvatarAnimations() {
            // Random eye movements
            state.eyeMovementInterval = setInterval(() => {
                moveEyesRandomly();
            }, 3000);
            
            // Natural blinking with sound
            state.blinkInterval = setInterval(() => {
                blinkEyes();
                if (Math.random() > 0.7) soundLibrary.blink();
            }, 4000);
            
            // Occasional subtle facial expressions
            setInterval(() => {
                if (!state.isAvatarTalking && Math.random() > 0.7) {
                    animateSubtleFacialExpression();
                }
            }, 8000);
            
            // Cursor following (subtle)
            document.addEventListener('mousemove', (e) => {
                if (state.isAvatarTalking) return;
                
                const avatar = document.querySelector('.human-avatar-container');
                const rect = avatar.getBoundingClientRect();
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;
                
                const deltaX = (e.clientX - centerX) / (rect.width / 2);
                const deltaY = (e.clientY - centerY) / (rect.height / 2);
                
                const maxOffset = 8;
                const offsetX = deltaX * maxOffset;
                const offsetY = deltaY * maxOffset;
                
                leftEyeInner.style.transform = `translate(calc(-50% + ${offsetX}px), calc(-50% + ${offsetY}px))`;
                rightEyeInner.style.transform = `translate(calc(-50% + ${offsetX}px), calc(-50% + ${offsetY}px))`;
            });
            
            console.log('ðŸ‘ï¸ Ultra realistic avatar animations with sound initialized');
        }

        function moveEyesRandomly() {
            if (state.isAvatarTalking) return;
            
            const maxOffset = 5;
            const leftX = (Math.random() * maxOffset * 2) - maxOffset;
            const leftY = (Math.random() * maxOffset * 2) - maxOffset;
            const rightX = (Math.random() * maxOffset * 2) - maxOffset;
            const rightY = (Math.random() * maxOffset * 2) - maxOffset;
            
            leftEyeInner.style.transform = `translate(calc(-50% + ${leftX}px), calc(-50% + ${leftY}px))`;
            rightEyeInner.style.transform = `translate(calc(-50% + ${rightX}px), calc(-50% + ${rightY}px))`;
        }

        function blinkEyes() {
            if (state.isAvatarTalking) return;
            
            leftEyelid.style.transform = 'scaleY(0.1)';
            rightEyelid.style.transform = 'scaleY(0.1)';
            
            setTimeout(() => {
                leftEyelid.style.transform = 'scaleY(1)';
                rightEyelid.style.transform = 'scaleY(1)';
            }, 150);
        }

        function animateSubtleFacialExpression() {
            const expressions = ['subtleSmile', 'thinkingFace', 'curiousLook'];
            const expression = expressions[Math.floor(Math.random() * expressions.length)];
            
            switch(expression) {
                case 'subtleSmile':
                    mouth.style.height = '35px';
                    soundLibrary.smile();
                    setTimeout(() => {
                        if (!state.isAvatarTalking) mouth.style.height = '40px';
                    }, 300);
                    break;
                case 'thinkingFace':
                    document.querySelector('.eyebrow-left').style.transform = 'rotate(10deg)';
                    document.querySelector('.eyebrow-right').style.transform = 'rotate(-10deg)';
                    soundLibrary.thinking();
                    setTimeout(() => {
                        document.querySelector('.eyebrow-left').style.transform = 'rotate(5deg)';
                        document.querySelector('.eyebrow-right').style.transform = 'rotate(-5deg)';
                    }, 500);
                    break;
                case 'curiousLook':
                    const avatar = document.querySelector('.human-avatar');
                    avatar.style.transform = 'rotateY(5deg)';
                    setTimeout(() => {
                        avatar.style.transform = 'rotateY(0deg)';
                    }, 300);
                    break;
            }
        }

        // Set Avatar Mood
        function setMood(mood) {
            state.currentMood = mood;
            state.currentEmotion = mood;
            localStorage.setItem('nexa_current_mood', mood);
            
            // Update UI
            const emotionEmojis = {
                'default': 'ðŸ˜Š Neutral',
                'thinking': 'ðŸ¤” Thinking',
                'happy': 'ðŸ˜„ Happy',
                'excited': 'ðŸŒŸ Excited'
            };
            avatarEmotion.textContent = emotionEmojis[mood] || 'ðŸ˜Š Neutral';
            
            // Update active button
            moodButtons.forEach(btn => {
                if (btn.dataset.mood === mood) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            
            // Apply visual effects
            const avatar = document.querySelector('.human-avatar');
            avatar.className = 'human-avatar';
            if (mood !== 'default') {
                avatar.classList.add(`emotion-${mood}`);
            }
            
            // Play mood-appropriate sound
            if (mood === 'happy' || mood === 'excited') {
                soundLibrary.smile();
            } else if (mood === 'thinking') {
                soundLibrary.thinking();
            }
            
            console.log(`ðŸŽ­ Mood set to: ${mood}`);
        }

        // Initialize Speech Recognition
        function initSpeechRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                state.recognition = new SpeechRecognition();
                state.recognition.continuous = false;
                state.recognition.interimResults = true;
                state.recognition.lang = 'en-US';
                
                state.recognition.onstart = () => {
                    state.isListening = true;
                    voiceBtn.classList.add('listening');
                    voiceBtn.innerHTML = '<i class="fas fa-stop"></i>';
                    statusText.textContent = 'Listening...';
                    showNotification('Voice Input', 'Speak now...', 'info');
                    
                    // Animate mouth while listening
                    mouth.classList.add('talking');
                    soundLibrary.notification();
                };
                
                state.recognition.onresult = (event) => {
                    let finalTranscript = '';
                    
                    for (let i = event.resultIndex; i < event.results.length; i++) {
                        const transcript = event.results[i][0].transcript;
                        if (event.results[i].isFinal) {
                            finalTranscript += transcript;
                        }
                    }
                    
                    if (finalTranscript) {
                        chatInput.value = finalTranscript;
                        setTimeout(() => sendMessage(), 500);
                    }
                };
                
                state.recognition.onend = () => {
                    state.isListening = false;
                    voiceBtn.classList.remove('listening');
                    voiceBtn.innerHTML = '<i class="fas fa-microphone"></i>';
                    statusText.textContent = state.isConnected ? 'Gemini Connected' : 'Demo Mode';
                    mouth.classList.remove('talking');
                };
                
                state.recognition.onerror = (event) => {
                    showNotification('Voice Error', `Error: ${event.error}`, 'error');
                    voiceBtn.classList.remove('listening');
                    voiceBtn.innerHTML = '<i class="fas fa-microphone"></i>';
                };
                
                console.log('ðŸŽ¤ Speech recognition initialized');
            } else {
                console.warn('Speech recognition not supported');
                voiceBtn.style.opacity = '0.5';
                voiceBtn.title = "Voice input not supported";
            }
        }

        // Setup Event Listeners
        function setupEventListeners() {
            // Send message
            sendBtn.addEventListener('click', sendMessage);
            chatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
            
            // Voice input
            voiceBtn.addEventListener('click', toggleVoiceInput);
            
            // Connect button
            connectBtn.addEventListener('click', () => {
                if (state.isConnected) {
                    disconnectFromAPI();
                } else {
                    connectToAPI();
                }
            });
            
            // Test connection
            testConnection.addEventListener('click', testGeminiConnection);
            
            // API key visibility toggle
            toggleApiKey.addEventListener('click', () => {
                if (apiKeyInput.type === 'password') {
                    apiKeyInput.type = 'text';
                    toggleApiKey.innerHTML = '<i class="fas fa-eye-slash"></i>';
                } else {
                    apiKeyInput.type = 'password';
                    toggleApiKey.innerHTML = '<i class="fas fa-eye"></i>';
                }
            });
            
            // API key input
            apiKeyInput.addEventListener('input', (e) => {
                if (e.target.value && !e.target.value.startsWith('â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢')) {
                    state.apiKey = e.target.value;
                    localStorage.setItem('nexa_gemini_api_key', state.apiKey);
                }
            });
            
            // Quick questions navigation
            navQuestions.addEventListener('click', (e) => {
                e.preventDefault();
                quickQuestions.classList.toggle('show');
                navHome.classList.remove('active');
                navQuestions.classList.add('active');
            });
            
            navHome.addEventListener('click', (e) => {
                e.preventDefault();
                quickQuestions.classList.remove('show');
                navQuestions.classList.remove('active');
                navHome.classList.add('active');
            });
            
            // Mood buttons
            moodButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    const mood = btn.dataset.mood;
                    setMood(mood);
                });
            });
            
            // Question buttons
            questionButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    const questionType = btn.dataset.question;
                    askQuickQuestion(questionType);
                    quickQuestions.classList.remove('show');
                    navQuestions.classList.remove('active');
                    navHome.classList.add('active');
                });
            });
            
            // Notification close
            notificationClose.addEventListener('click', closeNotification);
            
            console.log('ðŸŽ® Event listeners setup complete');
        }

        // Ask Quick Question
        function askQuickQuestion(type) {
            const category = knowledgeBase[type];
            if (!category || category.length === 0) return;
            
            const randomQuestion = category[Math.floor(Math.random() * category.length)];
            
            // Add question to chat
            addMessage(randomQuestion.question, 'user');
            
            // Show typing indicator with sound
            showTypingIndicator();
            soundLibrary.typing();
            
            // Set appropriate mood
            setMood(randomQuestion.mood);
            
            // Simulate thinking delay
            setTimeout(() => {
                removeTypingIndicator();
                addMessage(randomQuestion.answer, 'ai', randomQuestion.emotion);
                animateAvatarTalking(randomQuestion.answer.length);
                
                // Save to conversation history
                state.conversationHistory.push({
                    role: 'user',
                    content: randomQuestion.question,
                    timestamp: new Date().toISOString()
                });
                
                state.conversationHistory.push({
                    role: 'assistant',
                    content: randomQuestion.answer,
                    emotion: randomQuestion.emotion,
                    timestamp: new Date().toISOString()
                });
                
                saveConversationHistory();
                
            }, 1500 + Math.random() * 1000);
        }

        // Test Gemini API Connection
        async function testGeminiConnection() {
            const apiKey = apiKeyInput.value;
            
            if (!apiKey || apiKey.startsWith('â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢')) {
                showNotification('No API Key', 'Please enter your Gemini API key first', 'warning');
                apiKeyInput.focus();
                return;
            }
            
            // Show testing state
            testConnection.disabled = true;
            testConnection.classList.add('testing');
            testConnection.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Testing Connection...';
            
            try {
                // Store the key
                state.apiKey = apiKey;
                localStorage.setItem('nexa_gemini_api_key', apiKey);
                
                // Test with a simple request
                const response = await axios.post(
                    `https://generativelanguage.googleapis.com/v1/models/gemini-1.5-flash:generateContent
?key=${apiKey}`,
                    {
                        contents: [{
                            parts: [{
                                text: "Hello"
                            }]
                        }],
                        generationConfig: {
                            maxOutputTokens: 10
                        }
                    },
                    {
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        timeout: 10000
                    }
                );
                
                if (response.data && response.data.candidates && response.data.candidates[0]) {
                    // Connection successful
                    testConnection.classList.remove('testing');
                    testConnection.classList.add('connected');
                    testConnection.innerHTML = '<i class="fas fa-check"></i> Connected to Gemini!';
                    
                    showNotification(
                        'Connection Successful!',
                        'Successfully connected to Google Gemini API.',
                        'success'
                    );
                    soundLibrary.notification();
                    
                    // Enable connection
                    state.isConnected = true;
                    state.isDemoMode = false;
                    updateUIState();
                    
                    // Add success message to chat
                    addMessage("âœ… Successfully connected to Google Gemini! I'm now powered by real AI with enhanced emotional intelligence. How can I assist you today?", 'ai', 'excited');
                    
                } else {
                    throw new Error('Invalid response from Gemini API');
                }
                
            } catch (error) {
                console.error('Gemini API test failed:', error);
                
                testConnection.classList.remove('testing');
                testConnection.innerHTML = '<i class="fas fa-plug"></i> Test Connection';
                testConnection.disabled = false;
                
                let errorMessage = 'Failed to connect to Gemini API. ';
                
                if (error.response) {
                    if (error.response.status === 400) {
                        errorMessage += 'Invalid API key or request format.';
                    } else if (error.response.status === 403) {
                        errorMessage += 'API key is invalid or disabled.';
                    } else if (error.response.status === 429) {
                        errorMessage += 'Rate limit exceeded. Try again later.';
                    } else {
                        errorMessage += `Server error: ${error.response.status}`;
                    }
                } else if (error.request) {
                    errorMessage += 'No response from server. Check your internet connection.';
                } else {
                    errorMessage += error.message;
                }
                
                showNotification('Connection Failed', errorMessage, 'error');
                
                // Clear invalid key
                state.apiKey = '';
                localStorage.removeItem('nexa_gemini_api_key');
                apiKeyInput.value = '';
            }
        }

        // Send Message with Enhanced Responses
        async function sendMessage() {
            const message = chatInput.value.trim();
            if (!message || state.isTyping) return;
            
            // Clear input
            chatInput.value = '';
            
            // Add user message
            addMessage(message, 'user');
            
            // Show typing indicator with sound
            showTypingIndicator();
            soundLibrary.typing();
            state.isTyping = true;
            chatInput.disabled = true;
            sendBtn.disabled = true;
            
            try {
                let aiResponse;
                let emotion = 'default';
                
                if (state.isConnected && state.apiKey) {
                    // REAL GEMINI API CALL with emotional context
                    const prompt = `Respond as an emotionally intelligent AI assistant. The user asked: "${message}" 
                    
                    Consider their emotional state and respond appropriately. You can be:
                    - Encouraging and supportive for life advice
                    - Creative and inspiring for creativity questions
                    - Practical and clear for career advice
                    - Empathetic and understanding for relationship issues
                    - Motivational for motivation questions
                    - Analytical for problem-solving
                    - Calming for stress/anxiety
                    - Enthusiastic for learning
                    
                    Add appropriate emotional tone indicators in your response.`;
                    
                    aiResponse = await callGeminiAPI(prompt);
                    
                    // Analyze response for emotional tone
                    emotion = analyzeEmotion(aiResponse);
                    
                } else {
                    // Enhanced demo mode with emotional responses
                    await new Promise(resolve => setTimeout(resolve, 1000 + Math.random() * 1000));
                    
                    // Check for keywords to provide appropriate response
                    if (message.toLowerCase().includes('life') || message.includes('purpose') || message.includes('happiness')) {
                        const lifeResponses = knowledgeBase.life_advice;
                        const randomResponse = lifeResponses[Math.floor(Math.random() * lifeResponses.length)];
                        aiResponse = randomResponse.answer;
                        emotion = randomResponse.emotion;
                        setMood(randomResponse.mood);
                    } else if (message.toLowerCase().includes('creative') || message.includes('art') || message.includes('inspiration')) {
                        const creativeResponses = knowledgeBase.creativity;
                        const randomResponse = creativeResponses[Math.floor(Math.random() * creativeResponses.length)];
                        aiResponse = randomResponse.answer;
                        emotion = randomResponse.emotion;
                        setMood(randomResponse.mood);
                    } else {
                        // Generic enhanced response
                        aiResponse = getEnhancedDemoResponse(message);
                        emotion = analyzeEmotion(aiResponse);
                    }
                }
                
                // Remove typing indicator
                removeTypingIndicator();
                state.isTyping = false;
                
                // Add AI response with emotion
                addMessage(aiResponse, 'ai', emotion);
                
                // Animate avatar with emotional response
                animateAvatarTalking(aiResponse.length);
                
                // Save to conversation history
                state.conversationHistory.push({
                    role: 'user',
                    content: message,
                    timestamp: new Date().toISOString()
                });
                
                state.conversationHistory.push({
                    role: 'assistant',
                    content: aiResponse,
                    emotion: emotion,
                    timestamp: new Date().toISOString()
                });
                
                saveConversationHistory();
                
            } catch (error) {
                console.error('Error sending message:', error);
                
                removeTypingIndicator();
                state.isTyping = false;
                
                let errorMessage = 'Sorry, there was an error processing your request. ';
                
                if (error.response) {
                    if (error.response.status === 429) {
                        errorMessage = 'Rate limit exceeded. Please wait a moment before trying again.';
                        showNotification('Rate Limit', 'Gemini API rate limit exceeded. Try again in a minute.', 'warning');
                    } else if (error.response.status === 403) {
                        errorMessage = 'API key authentication failed. Please check your API key.';
                        state.isConnected = false;
                        state.isDemoMode = true;
                        updateUIState();
                        showNotification('Authentication Failed', 'Invalid API key. Please reconnect.', 'error');
                    } else {
                        errorMessage += `API Error: ${error.response.status}`;
                    }
                } else if (error.request) {
                    errorMessage = 'Network error. Please check your internet connection.';
                }
                
                addMessage(errorMessage, 'ai', 'sad');
                
                // If API failed, switch to demo mode
                if (state.isConnected) {
                    state.isConnected = false;
                    state.isDemoMode = true;
                    updateUIState();
                    showNotification('Switching to Demo', 'API connection failed. Using enhanced demo mode.', 'warning');
                }
            } finally {
                chatInput.disabled = false;
                sendBtn.disabled = false;
                chatInput.focus();
            }
        }

        // Enhanced Demo Response Generator
        function getEnhancedDemoResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            const responses = {
                greeting: [
                    "Hello! I'm excited to help you today! ðŸ˜Š How can I assist with your questions about life, creativity, or anything else on your mind?",
                    "Hi there! I'm here to provide thoughtful advice and creative inspiration. What would you like to explore today?",
                    "Welcome back! I'm ready to help you navigate life's challenges and unlock your creativity. What's on your mind?"
                ],
                life: [
                    "Life is a journey of continuous growth. Remember that challenges are opportunities in disguise, and every experience shapes who you become. What specific aspect of life would you like to discuss?",
                    "Finding meaning often comes from helping others and pursuing what genuinely interests you. Small daily actions create significant long-term results.",
                    "Happiness is often found in the present moment. Practice mindfulness and gratitude - they're scientifically proven to increase life satisfaction."
                ],
                creativity: [
                    "Creativity is like a muscle - it strengthens with practice. Try setting aside 15 minutes daily for creative play without expectations of results.",
                    "Creative blocks often come from perfectionism. Give yourself permission to create 'bad' art - it's the fastest way to breakthrough.",
                    "Inspiration is everywhere! Take a walk in nature, visit a museum, or try a completely new experience to spark fresh ideas."
                ],
                career: [
                    "A fulfilling career aligns with your values, utilizes your strengths, and addresses problems you care about solving.",
                    "Career growth often happens outside your comfort zone. Seek challenges that stretch your abilities while providing support systems."
                ],
                relationships: [
                    "Healthy relationships thrive on clear communication, mutual respect, and shared values. Remember to listen as much as you speak.",
                    "Boundaries aren't walls - they're gates that define what you're willing to accept while maintaining connection."
                ],
                default: [
                    "That's an interesting perspective! I'd love to explore this topic with you in more depth. Could you tell me more about what you're thinking?",
                    "Thanks for sharing! I'm designed to provide thoughtful, nuanced responses to complex questions. What aspect would you like to focus on?",
                    "I appreciate your question! With emotional intelligence and contextual understanding, I can provide personalized guidance on this topic."
                ]
            };
            
            // Determine which category the message falls into
            let category = 'default';
            
            if (lowerMessage.includes('hello') || lowerMessage.includes('hi') || lowerMessage.includes('hey')) {
                category = 'greeting';
            } else if (lowerMessage.includes('life') || lowerMessage.includes('purpose') || lowerMessage.includes('meaning')) {
                category = 'life';
            } else if (lowerMessage.includes('creative') || lowerMessage.includes('art') || lowerMessage.includes('inspire')) {
                category = 'creativity';
            } else if (lowerMessage.includes('career') || lowerMessage.includes('job') || lowerMessage.includes('work')) {
                category = 'career';
            } else if (lowerMessage.includes('relationship') || lowerMessage.includes('friend') || lowerMessage.includes('partner')) {
                category = 'relationships';
            }
            
            const categoryResponses = responses[category];
            return categoryResponses[Math.floor(Math.random() * categoryResponses.length)];
        }

        // Analyze Emotion from Text
        function analyzeEmotion(text) {
            const lowerText = text.toLowerCase();
            
            if (lowerText.includes('excited') || lowerText.includes('amazing') || lowerText.includes('wonderful') || 
                lowerText.includes('congratulation') || lowerText.includes('ðŸŽ‰') || lowerText.includes('ðŸŒŸ')) {
                return 'excited';
            } else if (lowerText.includes('sad') || lowerText.includes('sorry') || lowerText.includes('unfortunately') ||
                      lowerText.includes('difficult') || lowerText.includes('challenging')) {
                return 'sad';
            } else if (lowerText.includes('think') || lowerText.includes('consider') || lowerText.includes('analyze') ||
                      lowerText.includes('perhaps') || lowerText.includes('maybe')) {
                return 'thinking';
            } else if (lowerText.includes('happy') || lowerText.includes('great') || lowerText.includes('good') ||
                      lowerText.includes('ðŸ˜Š') || lowerText.includes('ðŸ‘')) {
                return 'happy';
            } else if (lowerText.includes('important') || lowerText.includes('remember') || lowerText.includes('key') ||
                      lowerText.includes('essential')) {
                return 'serious';
            } else {
                return 'default';
            }
        }

        // REAL Gemini API Call Function
        async function callGeminiAPI(prompt) {
            const response = await axios.post(
                `https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${state.apiKey}`,
                {
                    contents: [
                        {
                            role: "user",
                            parts: [{ text: prompt }]
                        }
                    ],
                    generationConfig: {
                        temperature: 0.8,
                        topK: 1,
                        topP: 0.95,
                        maxOutputTokens: 1024
                    },
                    safetySettings: [
                        {
                            category: "HARM_CATEGORY_HARASSMENT",
                            threshold: "BLOCK_MEDIUM_AND_ABOVE"
                        },
                        {
                            category: "HARM_CATEGORY_HATE_SPEECH",
                            threshold: "BLOCK_MEDIUM_AND_ABOVE"
                        },
                        {
                            category: "HARM_CATEGORY_SEXUALLY_EXPLICIT",
                            threshold: "BLOCK_MEDIUM_AND_ABOVE"
                        },
                        {
                            category: "HARM_CATEGORY_DANGEROUS_CONTENT",
                            threshold: "BLOCK_MEDIUM_AND_ABOVE"
                        }
                    ]
                },
                {
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    timeout: 30000
                }
            );
            
            if (response.data && response.data.candidates && response.data.candidates[0]) {
                return response.data.candidates[0].content.parts[0].text;
            } else {
                throw new Error('Invalid response from Gemini API');
            }
        }

        // Save Conversation History
        function saveConversationHistory() {
            if (state.conversationHistory.length > 50) {
                state.conversationHistory = state.conversationHistory.slice(-50);
            }
            localStorage.setItem('nexa_conversation', JSON.stringify(state.conversationHistory));
        }

        // Update UI State
        function updateUIState() {
            if (state.isConnected) {
                statusText.textContent = 'Gemini Connected';
                connectBtn.textContent = 'Disconnect';
                connectionStatus.textContent = 'Gemini API Connected';
                modelStatus.textContent = 'Gemini Pro + Emotional AI';
                chatInput.placeholder = 'Ask me anything with emotional intelligence...';
            } else {
                statusText.textContent = 'Enhanced Demo Mode';
                connectBtn.textContent = 'Connect API';
                connectionStatus.textContent = 'Enhanced Demo';
                modelStatus.textContent = 'Emotional AI Simulator';
                chatInput.placeholder = 'Try enhanced demo or connect API for real AI...';
            }
        }

        // Toggle Voice Input
        function toggleVoiceInput() {
            if (!state.recognition) {
                showNotification('Not Supported', 'Voice recognition not available', 'error');
                return;
            }
            
            if (!state.isListening) {
                try {
                    state.recognition.start();
                } catch (error) {
                    showNotification('Microphone Error', 'Could not access microphone', 'error');
                }
            } else {
                state.recognition.stop();
            }
        }

        // Add Message to Chat with Emotion
        function addMessage(text, sender, emotion = 'default') {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            if (sender === 'ai' && emotion) {
                messageDiv.setAttribute('data-emotion', getEmotionLabel(emotion));
            }
            
            const time = new Date().toLocaleTimeString([], { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            
            const messageId = `msg-${Date.now()}`;
            messageDiv.id = messageId;
            
            // Format message with line breaks and emotion indicators
            let formattedText = text;
            
            // Add emotional indicators based on emotion
            if (sender === 'ai') {
                const emotionIndicators = {
                    'excited': 'ðŸŒŸ ',
                    'happy': 'ðŸ˜Š ',
                    'thinking': 'ðŸ¤” ',
                    'sad': 'ðŸ’­ ',
                    'serious': 'ðŸ“Œ ',
                    'default': 'ðŸ’¬ '
                };
                formattedText = (emotionIndicators[emotion] || 'ðŸ’¬ ') + text;
            }
            
            formattedText = formattedText.replace(/\n/g, '<br>');
            
            messageDiv.innerHTML = `
                ${sender === 'ai' ? `
                    <div class="message-avatar">
                        <i class="fas fa-robot"></i>
                    </div>
                ` : ''}
                
                <div class="message-bubble">${formattedText}</div>
                
                ${sender === 'user' ? `
                    <div class="message-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                ` : ''}
            `;
            
            chatMessages.appendChild(messageDiv);
            
            // Smooth scroll to new message
            messageDiv.scrollIntoView({ 
                behavior: 'smooth', 
                block: 'end' 
            });
        }

        // Get Emotion Label
        function getEmotionLabel(emotion) {
            const labels = {
                'excited': 'ðŸŒŸ Excited',
                'happy': 'ðŸ˜Š Happy',
                'thinking': 'ðŸ¤” Thinking',
                'sad': 'ðŸ’­ Reflective',
                'serious': 'ðŸ“Œ Important',
                'default': 'ðŸ’¬ Neutral'
            };
            return labels[emotion] || 'ðŸ’¬ Neutral';
        }

        // Show Typing Indicator
        function showTypingIndicator() {
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message ai';
            typingDiv.id = 'typingIndicator';
            
            typingDiv.innerHTML = `
                <div class="message-avatar">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="message-bubble">
                    <div style="display: flex; gap: 6px; padding: 10px;">
                        <div style="width: 8px; height: 8px; background: var(--primary); border-radius: 50%; animation: typingBounce 1.4s infinite ease-in-out;"></div>
                        <div style="width: 8px; height: 8px; background: var(--primary); border-radius: 50%; animation: typingBounce 1.4s infinite ease-in-out; animation-delay: -0.32s;"></div>
                        <div style="width: 8px; height: 8px; background: var(--primary); border-radius: 50%; animation: typingBounce 1.4s infinite ease-in-out; animation-delay: -0.16s;"></div>
                    </div>
                </div>
            `;
            
            chatMessages.appendChild(typingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Remove Typing Indicator
        function removeTypingIndicator() {
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        // Animate Avatar Talking with Emotional Expressions
        function animateAvatarTalking(durationFactor) {
            if (state.isAvatarTalking) return;
            
            state.isAvatarTalking = true;
            mouth.classList.add('talking');
            
            // Add emotional expression based on current mood
            switch(state.currentMood) {
                case 'excited':
                    // Wider mouth animation for excitement
                    mouth.style.width = '130px';
                    break;
                case 'thinking':
                    // Subtler mouth movement for thinking
                    mouth.style.height = '30px';
                    break;
                case 'happy':
                    // Smiling animation
                    mouth.style.borderRadius = '50%';
                    break;
            }
            
            // Calculate duration based on text length
            const duration = Math.min(5000, Math.max(1000, durationFactor * 15));
            
            setTimeout(() => {
                mouth.classList.remove('talking');
                state.isAvatarTalking = false;
                
                // Reset mouth to normal
                mouth.style.width = '120px';
                mouth.style.height = '40px';
                mouth.style.borderRadius = '0 0 60px 60px';
            }, duration);
        }

        // Show Notification with Sound
        function showNotification(title, message, type = 'info') {
            notificationTitle.textContent = title;
            notificationMessage.textContent = message;
            
            // Set type
            notification.className = `notification ${type}`;
            const icon = notification.querySelector('.notification-icon i');
            
            switch(type) {
                case 'success':
                    icon.className = 'fas fa-check-circle';
                    break;
                case 'error':
                    icon.className = 'fas fa-exclamation-circle';
                    break;
                case 'warning':
                    icon.className = 'fas fa-exclamation-triangle';
                    break;
                default:
                    icon.className = 'fas fa-info-circle';
            }
            
            // Show notification
            notification.classList.add('show');
            
            // Play sound
            if (type === 'success') {
                soundLibrary.notification();
            }
            
            // Auto-hide after delay
            setTimeout(() => {
                closeNotification();
            }, 5000);
        }

        function closeNotification() {
            notification.classList.remove('show');
        }

        // Disconnect from API
        function disconnectFromAPI() {
            state.isConnected = false;
            state.isDemoMode = true;
            state.apiKey = '';
            
            localStorage.removeItem('nexa_gemini_api_key');
            apiKeyInput.value = '';
            
            testConnection.classList.remove('connected', 'testing');
            testConnection.innerHTML = '<i class="fas fa-plug"></i> Test Connection';
            
            updateUIState();
            
            showNotification('Disconnected', 'Switched back to enhanced demo mode', 'info');
            addMessage("Disconnected from Gemini API. Now running in enhanced demo mode with emotional intelligence simulation.", 'ai', 'default');
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
